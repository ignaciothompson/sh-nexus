<div class="board-container">
    <!-- Top Navigation -->
    <header class="top-nav">
        <div class="nav-brand">
            <div class="brand-icon">
                <i class="bi bi-check2-square"></i>
            </div>
            <span class="brand-text">Str<span class="brand-accent">ata</span></span>
        </div>
        <nav class="nav-links">
            <a routerLink="/notes" class="nav-link">
                <i class="bi bi-journal-text"></i> Notes </a>
            <a routerLink="/tasks" class="nav-link active">
                <i class="bi bi-kanban"></i> Tasks </a>
        </nav>
        <div class="nav-actions">
            <button class="nav-btn nav-btn-primary" (click)="openCreateModal()">
                <i class="bi bi-plus-lg"></i> New Task </button>
        </div>
    </header>
    <!-- Kanban Board -->
    <main class="board-main">
        <div class="kanban-board"> @for (column of columns; track column.id) { <div class="kanban-column" [attr.data-status]="column.id" (dragover)="onDragOver($event)" (drop)="onDrop($event, column.id)">
                <div class="column-header">
                    <div class="column-title-wrapper">
                        <span class="column-icon" [class]="column.id">{{ column.icon }}</span>
                        <h2 class="column-title">{{ column.title }}</h2>
                    </div>
                    <span class="task-count">{{ column.tasks.length }}</span>
                </div>
                <div class="column-content"> @for (task of column.tasks; track task.id) { <div class="task-card" draggable="true" (dragstart)="onDragStart($event, task)" (dragend)="onDragEnd($event)">
                        <div class="task-header">
                            <h3 class="task-title">{{ task.title }}</h3>
                            <div class="task-actions">
                                <button class="btn-action" (click)="$event.stopPropagation(); openEditModal(task)" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn-action btn-danger" (click)="$event.stopPropagation(); deleteTask(task.id)" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div> @if (task.description) { <p class="task-description">{{ task.description }}</p> } <div class="task-meta"> @if (task.dueDate) { <span class="meta-badge" [class.overdue]="isOverdue(task)">
                                <i class="bi bi-calendar-event"></i> {{ task.dueDate | date:'mediumDate' }} </span> } @if (task.completedAt) { <span class="meta-badge completed">
                                <i class="bi bi-check-circle"></i> {{ task.completedAt | date:'short' }} </span> } </div>
                    </div> } @empty { <div class="empty-column">
                        <i class="bi bi-inbox"></i>
                        <p>No tasks</p>
                    </div> } </div>
            </div> } </div>
    </main>
    <!-- Modal --> @if (showModal) { <div class="modal-overlay" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2>{{ editingTask ? 'Edit Task' : 'New Task' }}</h2>
                <button class="btn-close" (click)="closeModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <form (ngSubmit)="saveTask()" class="modal-body">
                <div class="form-group">
                    <label for="title">Title</label>
                    <input id="title" type="text" class="form-control" [(ngModel)]="formData.title" name="title" required placeholder="Enter task title">
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" class="form-control" [(ngModel)]="formData.description" name="description" rows="4" placeholder="Describe the task..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status" class="form-control" [(ngModel)]="formData.status" name="status">
                            <option value="todo">To Do</option>
                            <option value="in-progress">In Progress</option>
                            <option value="done">Done</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dueDate">Due Date</label>
                        <input id="dueDate" type="date" class="form-control" [(ngModel)]="formData.dueDate" name="dueDate">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Task</button>
                </div>
            </form>
        </div>
    </div> }
</div>