<div class="board-wrapper">
    <!-- Header -->
    <app-planner-header 
        (newCard)="openNewCardModal()"
        (search)="onSearch($event)">
    </app-planner-header>

    <!-- Kanban Board -->
    <div class="board-container">
        <div class="board-columns">
            <div *ngFor="let column of columns" 
                 class="column"
                 [attr.data-status]="column.id"
                 (dragover)="onDragOver($event)"
                 (drop)="onDrop($event, column.id)">
                
                <!-- Column Header -->
                <div class="column-header">
                    <div class="column-title-wrapper">
                        <span class="column-icon">{{ column.icon }}</span>
                        <h3 class="column-title">{{ column.title }}</h3>
                        <span class="column-count">{{ column.tasks.length }}</span>
                    </div>
                    <button class="btn-add-card" 
                            (click)="openNewCardModal()"
                            title="Add card">
                        <span class="material-symbols-outlined">add</span>
                    </button>
                </div>

                <!-- Cards -->
                <div class="column-body">
                    <div *ngFor="let card of column.tasks"
                         class="task-card"
                         [class.overdue]="isOverdue(card)"
                         draggable="true"
                         (dragstart)="onDragStart($event, card)"
                         (dragend)="onDragEnd($event)"
                         (click)="openCardModal(card)">
                        
                        <!-- Card Header -->
                        <div class="card-header">
                            <span class="card-type-icon material-symbols-outlined">
                                {{ getCardTypeIcon(card.card_type) }}
                            </span>
                            <button class="btn-card-delete" 
                                    (click)="deleteCard(card.id, $event)"
                                    title="Delete">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>

                        <!-- Card Title -->
                        <h4 class="card-title">{{ card.title }}</h4>

                        <!-- Card Description -->
                        <p *ngIf="card.description" class="card-description">
                            {{ card.description }}
                        </p>

                        <!-- Todo Progress (for todo type cards) -->
                        <div *ngIf="card.card_type === 'todo' && card.todo_items" 
                             class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" 
                                     [style.width.%]="getTodoProgress(card)">
                                </div>
                            </div>
                            <span class="progress-text">
                                {{ getTodoCompletedCount(card) }}/{{ card.todo_items.length }}
                            </span>
                        </div>

                        <!-- Progress Bar (for progress type cards) -->
                        <div *ngIf="card.card_type === 'progress' && card.progress_value !== undefined" 
                             class="card-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" 
                                     [style.width.%]="card.progress_value">
                                </div>
                            </div>
                            <span class="progress-text">{{ card.progress_value }}%</span>
                        </div>

                        <!-- Card Footer -->
                        <div class="card-footer">
                            <!-- Tags -->
                            <div *ngIf="card.tags && card.tags.length > 0" class="card-tags">
                                <span *ngFor="let tag of card.tags.slice(0, 2)" 
                                      class="tag">
                                    {{ tag }}
                                </span>
                                <span *ngIf="card.tags.length > 2" 
                                      class="tag-more">
                                    +{{ card.tags.length - 2 }}
                                </span>
                            </div>

                            <div class="card-meta">
                                <!-- Priority -->
                                <span *ngIf="card.priority" 
                                      class="priority-dot"
                                      [style.background]="getPriorityColor(card.priority)"
                                      [title]="card.priority">
                                </span>

                                <!-- Due Date -->
                                <span *ngIf="card.due_date" 
                                      class="card-date"
                                      [class.overdue]="isOverdue(card)">
                                    <span class="material-symbols-outlined">calendar_today</span>
                                    {{ card.due_date | date:'MMM d' }}
                                </span>

                                <!-- Linked Items -->
                                <span *ngIf="card.linked_items && card.linked_items.length > 0"
                                      class="card-links"
                                      title="Linked items">
                                    <span class="material-symbols-outlined">link</span>
                                    {{ card.linked_items.length }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Add Card Button -->
                    <button class="btn-add-item" (click)="openNewCardModal()">
                        <span class="material-symbols-outlined">add</span>
                        Add card
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Card Modal (will create next) -->
<app-card-modal *ngIf="showCardModal"
                [card]="selectedCard"
                (save)="onCardSave($event)"
                (close)="closeCardModal()">
</app-card-modal>