<div class="dashboard-layout">
    <!-- Welcome Screen (first-time setup) -->
    <app-welcome *ngIf="showWelcome" (setupComplete)="onSetupComplete()"></app-welcome>
    <!-- Main Dashboard (hidden during setup) -->
    <ng-container *ngIf="!showWelcome">
        <!-- Sidebar -->
        <app-sidebar [activeRoute]="'home'" (openSettings)="openSettingsModal()">
        </app-sidebar>
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <h2 class="header-title">System Overview</h2>
                <div class="header-actions">
                    <!-- Search Bar -->
                    <div class="search-wrapper">
                        <span class="material-symbols-outlined search-icon">search</span>
                        <input type="text" class="search-input" placeholder="Search logs, apps..." [(ngModel)]="searchQuery" (keydown.enter)="performSearch()">
                    </div>
                    <!-- Action Buttons -->
                    <div class="header-buttons">
                        <button class="header-btn" title="Power Options">
                            <span class="material-symbols-outlined">power_settings_new</span>
                        </button>
                    </div>
                </div>
            </header>
            <!-- Scrollable Content -->
            <div class="content-scroll">
                <div class="content-wrapper">
                    <!-- Time & Status Section -->
                    <section class="hero-section">
                        <div class="time-block">
                            <h1 class="time-display"> {{currentTime | date:'HH:mm'}} <span class="time-period">{{currentTime | date:'a'}}</span>
                            </h1>
                            <p class="date-display"> {{currentTime | date:'EEEE, MMM d'}} • System Optimal </p>
                        </div>
                        <!-- Status Pills -->
                        <div class="status-pills">
                            <div class="glass-pill status-card">
                                <div class="status-header">
                                    <span class="status-label">CPU Load</span>
                                    <span class="material-symbols-outlined status-icon text-primary">memory</span>
                                </div>
                                <div class="status-value">
                                    <span class="value-main">{{hostStats?.cpuPercent || 12}}%</span>
                                </div>
                                <div class="status-bar-bg">
                                    <div class="status-bar-fill bg-primary" [style.width.%]="hostStats?.cpuPercent || 12"></div>
                                </div>
                            </div>
                            <div class="glass-pill status-card">
                                <div class="status-header">
                                    <span class="status-label">RAM</span>
                                    <span class="material-symbols-outlined status-icon text-purple">storage</span>
                                </div>
                                <div class="status-value">
                                    <span class="value-main">{{hostStats?.memPercent || 32}}%</span>
                                </div>
                                <div class="status-bar-bg">
                                    <div class="status-bar-fill bg-purple" [style.width.%]="hostStats?.memPercent || 32"></div>
                                </div>
                            </div>
                            <div class="glass-pill status-card">
                                <div class="status-header">
                                    <span class="status-label">Temp</span>
                                    <span class="material-symbols-outlined status-icon text-red">thermostat</span>
                                </div>
                                <div class="status-value">
                                    <span class="value-main">45°C</span>
                                    <span class="value-sub text-primary">Stable</span>
                                </div>
                                <div class="status-bar-bg">
                                    <div class="status-bar-fill bg-gradient-temp" style="width: 45%"></div>
                                </div>
                            </div>
                            <div class="glass-pill status-card status-card-accent">
                                <div class="status-header">
                                    <span class="status-label">Storage</span>
                                    <span class="material-symbols-outlined status-icon text-blue">cloud</span>
                                </div>
                                <div class="status-value">
                                    <span class="value-main">{{hostStats?.disk?.total || '12'}}<span class="value-unit">TB</span></span>
                                </div>
                                <div class="status-footer">
                                    <span>Free: {{hostStats?.disk?.free || '4TB'}}</span>
                                    <span>Used: {{hostStats?.disk?.usage || '75%'}}</span>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- Quick Access & Notifications Row -->
                    <section class="two-col-section">
                        <!-- Quick Access -->
                        <div class="quick-access-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <span class="material-symbols-outlined text-yellow">bolt</span> Quick Access
                                </h3>
                                <button class="section-menu-btn" (click)="openReorderModal()">
                                    <span class="material-symbols-outlined">more_horiz</span>
                                </button>
                            </div>
                            <div class="quick-access-grid">
                                <div *ngFor="let item of bookmarks; trackBy: trackById" class="glass-panel quick-card" (click)="openUrl(item.url)">
                                    <div class="quick-icon" [ngClass]="getQuickIconClass(item)">
                                        <img *ngIf="item.icon && !$any(item).iconError" [src]="item.icon" [alt]="item.name" class="quick-icon-img" (error)="$any(item).iconError = true">
                                        <span *ngIf="!item.icon || $any(item).iconError" class="material-symbols-outlined">{{getQuickIcon(item)}}</span>
                                    </div>
                                    <div class="quick-info">
                                        <span class="quick-name">{{item.name}}</span>
                                        <span class="quick-desc">{{item.url | slice:0:30}}</span>
                                    </div>
                                    <!-- Config Button -->
                                    <button class="quick-config-btn" (click)="openEditModal(item); $event.stopPropagation()">
                                        <span class="material-symbols-outlined">settings</span>
                                    </button>
                                </div>
                                <!-- Add Button for Quick Access -->
                                <div class="glass-panel quick-card quick-card-add" (click)="openAddBookmarkModal()">
                                    <span class="material-symbols-outlined add-icon">add</span>
                                    <span class="add-label">Add Shortcut</span>
                                </div>
                            </div>
                        </div>
                        <!-- Notifications -->
                        <div class="notifications-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <span class="material-symbols-outlined text-red">notifications_active</span> Notifications & Alerts
                                </h3>
                                <button class="section-action">Clear All</button>
                            </div>
                            <div class="glass-panel notifications-list">
                                <div class="notif-empty" *ngIf="true">
                                    <span class="material-symbols-outlined">check_circle</span>
                                    <span>No new notifications</span>
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- App Sections Grid -->
                    <section class="apps-sections">
                        <div *ngFor="let section of sections; trackBy: trackById" class="app-section-block">
                            <!-- Section Header -->
                            <div class="section-header">
                                <h3 class="section-title">
                                    <span class="material-symbols-outlined" [ngClass]="getSectionIconClass(section)"> {{getSectionIcon(section)}} </span> {{section.title}}
                                </h3>
                                <div class="section-controls">
                                    <!-- Pagination -->
                                    <ng-container *ngIf="section.AppItems && section.AppItems.length > 6">
                                        <button class="pagination-btn" (click)="prevPage(section)" [disabled]="getSectionPage(section) === 0">
                                            <span class="material-symbols-outlined">chevron_left</span>
                                        </button>
                                        <span class="pagination-info"> {{getSectionPage(section) + 1}}/{{getTotalPages(section)}} </span>
                                        <button class="pagination-btn" (click)="nextPage(section)" [disabled]="getSectionPage(section) >= getTotalPages(section) - 1">
                                            <span class="material-symbols-outlined">chevron_right</span>
                                        </button>
                                    </ng-container>
                                    <button class="section-menu-btn" (click)="openReorderModal(section)">
                                        <span class="material-symbols-outlined">more_horiz</span>
                                    </button>
                                </div>
                            </div>
                            <!-- Apps Grid (6 items per page) -->
                            <div class="apps-grid">
                                <div *ngFor="let item of getPagedApps(section); trackBy: trackById" class="app-item-wrapper">
                                    <app-app-tile [app]="item" [editMode]="false" (edit)="openEditModal($event)" (delete)="onDeleteApp($event)">
                                    </app-app-tile>
                                </div>
                                <!-- Add Button (only on last page if room) -->
                                <div *ngIf="showAddButton(section)" class="app-card app-card-add" (click)="openAddModalForSection(section)">
                                    <span class="material-symbols-outlined">add</span>
                                    <span class="add-label">Add</span>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
</div>
<!-- Modal -->
<app-edit-app-modal *ngIf="showModal" [app]="editingItem" [sections]="sections" (saveApp)="onSaveApp($event)" (deleteApp)="onDeleteApp($event); showModal = false" (cancel)="showModal = false">
</app-edit-app-modal>
<!-- Settings Modal -->
<app-settings-modal *ngIf="showSettingsModal" [sections]="sections" (close)="onSettingsClose()" (sectionsUpdated)="loadSections()">
</app-settings-modal>
<!-- Reorder Modal -->
<div class="reorder-modal-overlay" *ngIf="showReorderModal" (click)="closeReorderModal()">
    <div class="reorder-modal" (click)="$event.stopPropagation()">
        <div class="reorder-header">
            <h3>Reorder {{reorderTitle}}</h3>
            <button class="close-btn" (click)="closeReorderModal()">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div class="reorder-list">
            <div *ngFor="let item of reorderItems; let i = index" class="reorder-item">
                <div class="reorder-item-info">
                    <img *ngIf="item.icon" [src]="item.icon" class="reorder-icon" (error)="$any(item).iconError = true" [hidden]="$any(item).iconError">
                    <span *ngIf="!item.icon || $any(item).iconError" class="material-symbols-outlined reorder-icon-fallback">link</span>
                    <span class="reorder-name">{{item.name}}</span>
                </div>
                <div class="reorder-actions">
                    <button class="reorder-btn" (click)="moveItemUp(i)" [disabled]="i === 0">
                        <span class="material-symbols-outlined">keyboard_arrow_up</span>
                    </button>
                    <button class="reorder-btn" (click)="moveItemDown(i)" [disabled]="i === reorderItems.length - 1">
                        <span class="material-symbols-outlined">keyboard_arrow_down</span>
                    </button>
                </div>
            </div>
            <div *ngIf="reorderItems.length === 0" class="reorder-empty">
                <span class="material-symbols-outlined">inventory_2</span>
                <span>No items to reorder</span>
            </div>
        </div>
        <div class="reorder-footer">
            <button class="btn-cancel" (click)="closeReorderModal()">Cancel</button>
            <button class="btn-save" (click)="saveReorder()">Save Order</button>
        </div>
    </div>
    </ng-container>
</div>